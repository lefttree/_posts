title: 复习JavaScript十一之理解内存管理
date: 2015-02-04 18:53:09
tags: node&js
---

一般来说内存管理主要有这么几种方式，引用计数和标记，而JavaScript采用的就是标记管理的方式。Js的内存管理是自动的，但是并不是说执行完后立马销毁，而是有时间周期性，相隔一段时间执行一下垃圾回收，把没有引用的内存全部销毁。

OC中采用的是引用计数来手动管理内存，这样的方式比较好，可以让开发者自己来管理。当然也有不好的地方，如果遗忘了释放，很可能引起应用的崩溃。

总体来看在IE中因为COM组件的原因，可能会发生循环引用的问题，这个问题在引用计数的内存管理都会遇见。所谓的循环引用是指在对象A中包含了一个指向B的指针，然后再对象B中包含一个指向A的指针，于是悲剧了。

	var element = document.getElementById('doc');
	var my = {};
	my.element = element;
	element.my = my;
	
大家都引用，于是，可想而知。要避免这种问题，一定要在不使用的时候my.element = null，把它断开。

那么，其他浏览器呢？还是标记清理的机制，比如一个函数的变量，在进入环境时标记上“进入环境”，执行完之后标记上“离开环境”，然后等待系统来释放。

IE有一个手动释放的方法，window.CollectGarbage，调用它就立马释放已经标记离开环境的变量，不过很多文章都不建议这样做。

那么一般都这样做，引用类型的释放

	var my = {};
	//使用完毕之后
	my = null;
	
让my脱离执行环境，标记上已经离开环境，然后等待系统执行垃圾回收，释放内存。

