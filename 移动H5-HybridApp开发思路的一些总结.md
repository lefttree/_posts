title: 移动H5-HybridApp开发思路的一些总结
date: 2015-01-10 15:04:24
tags: node&js
---

利用H5来开发移动app时，很大一部分的逻辑处理是在每一个视图的切换上，包括维护生命周期，释放内存，以及维护动画。我们在使用iOS时，基本上当前屏幕中内容显示的区域内就应该算是一个视图，当然H5版的app跟纯粹的iOS开发又有一些不同。

* H5版本的app是一个HTML页面，场景的切换基本上是切换内部的div容器，而当前浏览器内的框架则是它的window
* H5版本的app还需要监听hashchange或者history，来维护每一个视图控制器js文件的加载，执行
* 每一个视图控制器需要维护它自身的生命周期，如创建，渲染视图，添加事件，销毁，以及离开当前视图时等一系列的生命周期
* 一个视图控制器对应一个视图，一个模型，视图控制器来控制模型的请求，视图的渲染，模型与视图之间互相不干扰
* H5版本的app还需要维护一个NavigationController的头，用来控制内容区域内的视图控制器的转换以及它的动画
* 应用兼容iOS，安卓，WP手持设备的dom兼容库（zepto），以及手势，触摸事件的兼容处理
* 关于请求还需要维护本地存储与它之间的联系
* 在Hybrid中，要构建起与原生框架的交互桥梁，比如phoneGap
* 维护一个UI组件交互的库，比如一些常用的scoll，slider等

从上述的一些总结中，可以看的出来要开发基于H5的移动端app，需要做的事情还是有很多的，浓缩的总结有三个方面：

> 代码组织，MVC或者MVVM以及它们的生命周期与文件加载

> DOM 触摸 手势兼容处理

> 与Native的交互

在代码实现的思路上，这里都会使用一个栈来实现它。

* 栈顶属于当前视图控制器
* 基栈则是根视图控制器

<!--more-->

##思路实现的假设

每一个视图都会对应一个hash，可以监听window的hashchange事件来获取，而这个hash值做为一个唯一标识，用于map映射到对应的视图控制器实例上。

设计一个大的框架（page）根据功能或者业务划分，每个不同的业务需要使用不同的lcepy.github.io/page1/index.html  lcepy.github.io/page2/index.html，如果hash值为空，则默认为#index。这样的设计主要是考虑内存的消耗，释放的问题。因为业务代码不受约束，如果开发人员没有主动的意识，很可能出现溢出程序崩溃的情况。

每一个视图控制器最少要存在三个方法用于描述它的生命周期：

* __init__ 整个视图控制器的入口
* __hide__ 当离开当前视图时执行
* __viewwillapper__ 在创建视图容器时先执行

每一个视图控制器最少要存在四个属性用于描述它的视图，标识，模版等：

* __hash__ 用于描述它的hash值
* __view__ 存储视图的容器DOM对象
* __didkeys__ 用于描述它创建时的唯一标识，hash值+当前时间的毫秒数
* __template__ 用于描述当前视图的模版

> 场景假设：用户打开#index，并且点击一个按钮到#push

> 框架假设：navigationController 简称NC

最少会执行下面的一些动作，以及可能会使用到下列的一些库：**zepto requrejs template**

当客户端呈现#index页面时，会做如下的一些事情：

* 获取hash值index，先检索NC的一个队列中是否存在index，如果不存在则利用requrejs加载index.js文件，map进入NC队列，标示这个文件已经加载，将来不重复加载。
* 文件加载成功后，可以获取到index视图控制器类，实例化，并把它压入栈，调用viewwillapper，生成一个视图容器
* 视图容器DOM对象赋值给view
* 加载的模版字符串赋值给template，并渲染到视图容器中
* 执行init方法

当点击某个按钮，进入#push页面时，会做如下的一些事情：

* 获取hash值并检索NC加载文件，实例化，入栈
* 调用基栈hide方法，并出栈，然后销毁释放内存
* 执行呈现#index时的那些动作

当然一个比较成熟的项目需要处理的问题，肯定不是现在写的这些。

**总结在携程一年（移动开发）**




















